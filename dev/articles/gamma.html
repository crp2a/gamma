<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="gamma">
<title>Manual • gamma</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Manual">
<meta property="og:description" content="gamma">
<meta property="og:image" content="https://crp2a.github.io/gamma/logo.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@CRP2A">
<meta name="twitter:site" content="@CRP2A">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gamma</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/gamma.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/doserate.html">Calibration Curve</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/crp2a/gamma/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Manual</h1>
                        <h4 data-toc-skip class="author">N. Frerebeau</h4>
            
            <h4 data-toc-skip class="date">2022-08-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/crp2a/gamma/blob/HEAD/vignettes/gamma.Rmd" class="external-link"><code>vignettes/gamma.Rmd</code></a></small>
      <div class="d-none name"><code>gamma.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://crp2a.github.io/gamma/">gamma</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><strong>gamma</strong> is intended to process in-situ gamma-ray spectrometry measurements for luminescence dating. This package allows to import, inspect and (automatically) correct the energy scale of the spectrum. It provides methods for estimating the gamma dose rate by the use of a calibration curve. This package only supports Canberra CNF and TKA files.</p>
<p>Typical workflow:</p>
<ol style="list-style-type: decimal">
<li>Import spectrum data with <code><a href="../reference/read.html">read()</a></code>,</li>
<li>Inspect spectrum with <code><a href="../reference/plot.html">plot()</a></code>,</li>
<li>Calibrate the energy scale with <code>calibrate_energy()</code>,</li>
<li>Estimate the gamma dose rate with <code>predict_dose()</code>.</li>
</ol>
<p>The estimation of the gamma dose rate requires a calibration curve. This package contains several built-in curves, but as these are instrument-specific you may need to build your own (see <code>help(fit)</code>). These built-in curves are in use in several labs and can be used to reproduce published results. Check out the following vignettes for an overview of the fitting process.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># IRAMAT-CRP2A LaBr (BDX1)</span></span>
<span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"CRP2A#1"</span>, package <span class="op">=</span> <span class="st">"gamma"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># CEREGE NaI (AIX1)</span></span>
<span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"CEREGE#1"</span>, package <span class="op">=</span> <span class="st">"gamma"</span><span class="op">)</span></span></code></pre></div>
<p>Note that <strong>gamma</strong> uses the <em>International System of Units</em>: energy values are assumed to be in keV and dose rates in µGy/y.</p>
</div>
<div class="section level2">
<h2 id="import-file">Import file<a class="anchor" aria-label="anchor" href="#import-file"></a>
</h2>
<p>Both Canberra CNF and TKA files can be imported.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Automatically skip the first channels</span></span>
<span><span class="co"># Import a CNF file</span></span>
<span><span class="va">cnf_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/LaBr.CNF"</span>, package <span class="op">=</span> <span class="st">"gamma"</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">spc_cnf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.html">read</a></span><span class="op">(</span><span class="va">cnf_test</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Gamma spectrum:</span></span>
<span><span class="co">#&gt; *  name: LaBr</span></span>
<span><span class="co">#&gt; *  date: 2019-02-07 11:48:18</span></span>
<span><span class="co">#&gt; *  live_time: 3385.54</span></span>
<span><span class="co">#&gt; *  real_time: 3403.67</span></span>
<span><span class="co">#&gt; *  channels: 1024</span></span>
<span><span class="co">#&gt; *  energy_min: -7</span></span>
<span><span class="co">#&gt; *  energy_max: 3124.91</span></span>
<span></span>
<span><span class="co"># Import a TKA file</span></span>
<span><span class="va">tka_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/LaBr.TKA"</span>, package <span class="op">=</span> <span class="st">"gamma"</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">spc_tka</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.html">read</a></span><span class="op">(</span><span class="va">tka_test</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Gamma spectrum:</span></span>
<span><span class="co">#&gt; *  name: LaBr</span></span>
<span><span class="co">#&gt; *  date: 2022-08-23 11:54:47</span></span>
<span><span class="co">#&gt; *  live_time: 3385.54</span></span>
<span><span class="co">#&gt; *  real_time: 3403.67</span></span>
<span><span class="co">#&gt; *  channels: 1024</span></span>
<span><span class="co">#&gt; *  energy_min: NA</span></span>
<span><span class="co">#&gt; *  energy_max: NA</span></span>
<span></span>
<span><span class="co"># Import all files in a given directory</span></span>
<span><span class="va">files_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"gamma"</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">spc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.html">read</a></span><span class="op">(</span><span class="va">files_test</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; A collection of 3 gamma spectra: BEGe, LaBr, LaBr</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="inspect-spectrum">Inspect spectrum<a class="anchor" aria-label="anchor" href="#inspect-spectrum"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot CNF spectrum</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">spc_cnf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="gamma_files/figure-html/inspect-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="calibrate-the-energy-scale">Calibrate the energy scale<a class="anchor" aria-label="anchor" href="#calibrate-the-energy-scale"></a>
</h2>
<p>The energy calibration of a spectrum is the most tricky part. To do this, you must specify the position of at least three observed peaks and the corresponding energy value (in keV).</p>
<p>The package allows you to provide the channel-energy pairs you want to use. However, the spectrum can be noisy so it is difficult to properly determine the peak channel. In this case, a better approach may be to pre-process the spectrum (variance-stabilization, smoothing and baseline correction) and perform a peak detection. Once the identified peaks are satisfactory, you can set the corresponding energy values (in keV) and use these lines to calibrate the energy scale of the spectrum.</p>
<p>Regardless of the approach you choose, it is strongly recommended to check the result before proceeding.</p>
<div class="section level3">
<h3 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h3>
<p>The following steps illustrate how to properly fine-tune the parameters for spectrum processing before peak detection.</p>
<div class="section level4">
<h4 id="clean">Clean<a class="anchor" aria-label="anchor" href="#clean"></a>
</h4>
<p>Several channels can be dropped to retain only part of the spectrum. If no specific value is provided, an attempt is made to define the number of channels to skip at the beginning of the spectrum. This drops all channels before the highest count maximum. This is intended to deal with the artefact produced by the rapid growth of random background noise towards low energies.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use a square root transformation</span></span>
<span><span class="va">sliced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/signal_slice.html">signal_slice</a></span><span class="op">(</span><span class="va">spc_tka</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="stabilization">Stabilization<a class="anchor" aria-label="anchor" href="#stabilization"></a>
</h4>
<p>The stabilization step aims at improving the identification of peaks with a low signal-to-noise ratio. This particularly targets higher energy peaks.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use a square root transformation</span></span>
<span><span class="va">transformed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stabilize.html">signal_stabilize</a></span><span class="op">(</span><span class="va">sliced</span>, f <span class="op">=</span> <span class="va">sqrt</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="smoothing">Smoothing<a class="anchor" aria-label="anchor" href="#smoothing"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use a 21 point Savitzky-Golay-Filter to smooth the spectrum</span></span>
<span><span class="va">smoothed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/smooth.html">signal_smooth</a></span><span class="op">(</span><span class="va">transformed</span>, method <span class="op">=</span> <span class="st">"savitzky"</span>, m <span class="op">=</span> <span class="fl">21</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="baseline-correction">Baseline correction<a class="anchor" aria-label="anchor" href="#baseline-correction"></a>
</h4>
<p>The baseline estimation is performed using the SNIP algorithm <span class="citation">(Ryan et al. 1988; Morháč et al. 1997; Morháč and Matoušek 2008)</span>. You can apply the LLS operator to your data, use a decreasing clipping window or change the number of iterations (see references).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate the baseline of a single file</span></span>
<span><span class="va">baseline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/baseline.html">signal_baseline</a></span><span class="op">(</span><span class="va">smoothed</span>, method <span class="op">=</span> <span class="st">"SNIP"</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot spectrum + baseline</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">smoothed</span>, <span class="va">baseline</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Spectrum + baseline"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="gamma_files/figure-html/baseline-estimate-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Substract the estimated baseline</span></span>
<span><span class="va">corrected</span> <span class="op">&lt;-</span> <span class="va">smoothed</span> <span class="op">-</span> <span class="va">baseline</span></span>
<span><span class="co"># Or, remove the baseline in one go</span></span>
<span><span class="co"># corrected &lt;- removeBaseline(smoothed)</span></span>
<span></span>
<span><span class="co"># Plot the corrected spectrum</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">corrected</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Baseline-corrected spectrum"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="gamma_files/figure-html/baseline-remove-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># You can remove the baseline of multiple spectra in one go</span></span>
<span><span class="co"># Note that the same parameters will be used for all spectra</span></span>
<span><span class="va">clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/baseline.html">signal_correct</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="peak-detection">Peak detection<a class="anchor" aria-label="anchor" href="#peak-detection"></a>
</h4>
<p>Once you have a baseline-corrected spectrum, you can try to automatically find peaks in the spectrum. A local maximum has to be the highest one in the given window and has to be higher than <span class="math inline">\(k\)</span> times the noise to be recognized as peak.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Detect peaks in a single file</span></span>
<span><span class="va">peaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/peaks_find.html">peaks_find</a></span><span class="op">(</span><span class="va">corrected</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot spectrum + peaks</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">corrected</span>, <span class="va">peaks</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Peaks"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="gamma_files/figure-html/peak-detection-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="energy-scale-calibration">Energy scale calibration<a class="anchor" aria-label="anchor" href="#energy-scale-calibration"></a>
</h4>
<p>If you know the correspondence between several channels and the energy scale, you can use these pairs of values to calibrate the spectrum. A second order polynomial model is fitted on these energy <em>vs</em> channel values, then used to predict the new energy scale of the spectrum.</p>
<p>You can use the results of the peak detection and set the expected energy values.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set the energy values (in keV)</span></span>
<span><span class="fu">set_energy</span><span class="op">(</span><span class="va">peaks</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">238</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">1461</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">2615</span><span class="op">)</span></span>
<span><span class="va">peaks</span></span>
<span><span class="co">#&gt; 3 peaks were detected.</span></span>
<span></span>
<span><span class="co"># Calibrate the spectrum using the peak positions</span></span>
<span><span class="va">scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/energy.html">energy_calibrate</a></span><span class="op">(</span><span class="va">spc_tka</span>, <span class="va">peaks</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the spectrum</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">scaled</span>, xaxis <span class="op">=</span> <span class="st">"energy"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Calibrated spectrum"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="gamma_files/figure-html/calibrate-fit-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Alternatively, you can do it by hand.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a list of channel-enegy pairs</span></span>
<span><span class="va">calib_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  channel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">84</span>, <span class="fl">492</span>, <span class="fl">865</span><span class="op">)</span>,</span>
<span>  energy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">238</span>, <span class="fl">1461</span>, <span class="fl">2615</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calibrate the spectrum using these fixed lines</span></span>
<span><span class="va">scaled2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/energy.html">energy_calibrate</a></span><span class="op">(</span><span class="va">spc_tka</span>, lines <span class="op">=</span> <span class="va">calib_lines</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="use-the-pipe">Use the pipe!<a class="anchor" aria-label="anchor" href="#use-the-pipe"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Spectrum pre-processing and peak detection</span></span>
<span><span class="va">pks</span> <span class="op">&lt;-</span> <span class="va">spc_tka</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/signal_slice.html">signal_slice</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/stabilize.html">signal_stabilize</a></span><span class="op">(</span>f <span class="op">=</span> <span class="va">sqrt</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/smooth.html">signal_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"savitzky"</span>, m <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/baseline.html">signal_correct</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"SNIP"</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/peaks_find.html">peaks_find</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set the energy values (in keV)</span></span>
<span><span class="fu">set_energy</span><span class="op">(</span><span class="va">pks</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">238</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">1461</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">2615</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calibrate the energy scale</span></span>
<span><span class="va">cal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/energy.html">energy_calibrate</a></span><span class="op">(</span><span class="va">spc_tka</span>, <span class="va">pks</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot spectrum</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">cal</span>, <span class="va">pks</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="gamma_files/figure-html/pipe-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="estimate-the-gamma-dose-rate">Estimate the gamma dose rate<a class="anchor" aria-label="anchor" href="#estimate-the-gamma-dose-rate"></a>
</h2>
<p>To estimate the gamma dose rate, you can either use one of the calibration curves distributed with this package or build your own.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load one of the built-in curves</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">BDX_LaBr_1</span><span class="op">)</span> <span class="co"># IRAMAT-CRP2A (Bordeaux)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">AIX_NaI_1</span><span class="op">)</span> <span class="co"># CEREGE (Aix-en-Provence)</span></span></code></pre></div>
<p>The construction of a calibration curve requires a set of reference spectra for which the gamma dose rate is known and a background noise measurement. First, each reference spectrum is integrated over a given interval, then normalized to active time and corrected for background noise. The dose rate is finally modelled by the integrated signal value used as a linear predictor.</p>
<p>See <code>vignette(doserate)</code> for a reproducible example.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-morhac1997" class="csl-entry">
Morháč, Miroslav, Ján Kliman, Vladislav Matoušek, Martin Veselský, and Ivan Turzo. 1997. <span>“Background <span>Elimination Methods</span> for <span>Multidimensional Coincidence Γ</span>-<span>Ray Spectra</span>.”</span> <em>Nuclear Instruments and Methods in Physics Research Section A: Accelerators, Spectrometers, Detectors and Associated Equipment</em> 401 (1): 113–32. <a href="https://doi.org/10.1016/S0168-9002(97)01023-1" class="external-link">https://doi.org/10.1016/S0168-9002(97)01023-1</a>.
</div>
<div id="ref-morhac2008" class="csl-entry">
Morháč, Miroslav, and Vladislav Matoušek. 2008. <span>“Peak <span>Clipping Algorithms</span> for <span>Background Estimation</span> in <span>Spectroscopic Data</span>.”</span> <em>Applied Spectroscopy</em> 62 (1): 91–106. <a href="https://doi.org/10.1366/000370208783412762" class="external-link">https://doi.org/10.1366/000370208783412762</a>.
</div>
<div id="ref-ryan1988" class="csl-entry">
Ryan, C. G., E. Clayton, W. L. Griffin, S. H. Sie, and D. R. Cousens. 1988. <span>“<span>SNIP</span>, a <span>Statistics</span>-<span>Sensitive Background Treatment</span> for the <span>Quantitative Analysis</span> of <span>Pixe Spectra</span> in <span>Geoscience Applications</span>.”</span> <em>Nuclear Instruments and Methods in Physics Research Section B: Beam Interactions with Materials and Atoms</em> 34 (3): 396–402. <a href="https://doi.org/10.1016/0168-583X(88)90063-8" class="external-link">https://doi.org/10.1016/0168-583X(88)90063-8</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Nicolas Frerebeau, Brice Lebrun, Guilhem Paradol, <a href="https://www.u-bordeaux-montaigne.fr" class="external-link"><img src="https://crp2a.github.io/gamma/reference/figures/logo_ubm.jpg" height="64"></a>, <a href="https://www.cnrs.fr" class="external-link"><img src="https://crp2a.github.io/gamma/reference/figures/logo_cnrs.jpg" height="64"></a>, <a href="https://lascarbx.labex.u-bordeaux.fr" class="external-link"><img src="https://crp2a.github.io/gamma/reference/figures/logo_idex.png" height="80"></a>, <a href="https://amidex.univ-amu.fr" class="external-link"><img src="https://crp2a.github.io/gamma/reference/figures/logo_amidex.jpg" height="48"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
